"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./manifest.json"),t=require("./routes-manifest.json"),r=require("stream"),o=require("zlib"),n=require("http"),s=require("url"),i=require("https");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=a(e),c=a(t),f=a(r),l=a(o),d=a(n),p=a(s),h=a(i);const y={"accept-encoding":!0,"content-length":!0,"if-modified-since":!0,"if-none-match":!0,"if-range":!0,"if-unmodified-since":!0,"transfer-encoding":!0,via:!0},m={202:"Accepted",502:"Bad Gateway",400:"Bad Request",409:"Conflict",100:"Continue",201:"Created",417:"Expectation Failed",424:"Failed Dependency",403:"Forbidden",504:"Gateway Timeout",410:"Gone",505:"HTTP Version Not Supported",418:"I'm a teapot",419:"Insufficient Space on Resource",507:"Insufficient Storage",500:"Server Error",411:"Length Required",423:"Locked",420:"Method Failure",405:"Method Not Allowed",301:"Moved Permanently",302:"Moved Temporarily",207:"Multi-Status",300:"Multiple Choices",511:"Network Authentication Required",204:"No Content",203:"Non Authoritative Information",406:"Not Acceptable",404:"Not Found",501:"Not Implemented",304:"Not Modified",200:"OK",206:"Partial Content",402:"Payment Required",308:"Permanent Redirect",412:"Precondition Failed",428:"Precondition Required",102:"Processing",407:"Proxy Authentication Required",431:"Request Header Fields Too Large",408:"Request Timeout",413:"Request Entity Too Large",414:"Request-URI Too Long",416:"Requested Range Not Satisfiable",205:"Reset Content",303:"See Other",503:"Service Unavailable",101:"Switching Protocols",307:"Temporary Redirect",429:"Too Many Requests",401:"Unauthorized",422:"Unprocessable Entity",415:"Unsupported Media Type",305:"Use Proxy"},g={enableHTTPCompression:!1},b=(e,{enableHTTPCompression:t,rewrittenUri:r}=g)=>{const{request:o,response:n={headers:{}}}=e,s={headers:{}},i=new f.default.Readable,a=Object.assign(i,d.default.IncomingMessage.prototype);a.url=r||o.uri,a.method=o.method,a.rawHeaders=[],a.headers={},a.connection={},o.querystring&&(a.url=a.url+"?"+o.querystring);const u=o.headers||{};for(const e of Object.keys(u)){const t=u[e];t.forEach((e=>{a.rawHeaders.push(e.key),a.rawHeaders.push(e.value)})),a.headers[e]=t[0].value}a.getHeader=e=>a.headers[e.toLowerCase()],a.getHeaders=()=>a.headers,o.body&&o.body.data&&a.push(o.body.data,o.body.encoding?"base64":void 0),a.push(null);const c=new f.default;c.finished=!1,Object.defineProperty(c,"statusCode",{get:()=>s.status,set(e){s.status=e,s.statusDescription=m[e]}}),c.headers={},c.writeHead=(e,t)=>(s.status=e,t&&(c.headers=Object.assign(c.headers,t)),c),c.write=e=>{s.body||(s.body=Buffer.from("")),s.body=Buffer.concat([s.body,Buffer.isBuffer(e)?e:Buffer.from(e)])};let p=t&&(e=>{let t=!1;const r=e["accept-encoding"];if(r)for(let e=0;e<r.length;e++){const{value:o}=r[e];-1!==o.split(",").map((e=>e.split(";")[0].trim())).indexOf("gzip")&&(t=!0)}return t})(u);const h=new Promise((e=>{c.end=t=>{!0!==c.finished&&(c.finished=!0,t&&c.write(t),c.statusCode||(c.statusCode=200),s.body&&(s.bodyEncoding="base64",s.body=p?l.default.gzipSync(s.body).toString("base64"):Buffer.from(s.body).toString("base64")),s.headers=((e,t)=>{const r={},o={};return Object.entries(t).forEach((([e,t])=>{o[e.toLowerCase()]=t})),Object.keys(e).forEach((t=>{const n=t.toLowerCase(),s=e[t];y[n]?o[n]&&(r[n]=o[n]):(r[n]=[],s instanceof Array?s.forEach((e=>{r[n].push({key:t,value:e.toString()})})):r[n].push({key:t,value:s.toString()}))})),r})(c.headers,n.headers),p&&(s.headers["content-encoding"]=[{key:"Content-Encoding",value:"gzip"}]),e(s))}}));return c.setHeader=(e,t)=>{c.headers[e.toLowerCase()]=t},c.removeHeader=e=>{delete c.headers[e.toLowerCase()]},c.getHeader=e=>c.headers[e.toLowerCase()],c.getHeaders=()=>c.headers,c.hasHeader=e=>!!c.getHeader(e),{req:a,res:c,responsePromise:h}};b.SPECIAL_NODE_HEADERS=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];var w=b;function v(e,t){void 0===t&&(t={});for(var r=function(e){for(var t=[],r=0;r<e.length;){var o=e[r];if("*"!==o&&"+"!==o&&"?"!==o)if("\\"!==o)if("{"!==o)if("}"!==o)if(":"!==o)if("("!==o)t.push({type:"CHAR",index:r,value:e[r++]});else{var n=1,s="";if("?"===e[a=r+1])throw new TypeError('Pattern cannot start with "?" at '+a);for(;a<e.length;)if("\\"!==e[a]){if(")"===e[a]){if(0==--n){a++;break}}else if("("===e[a]&&(n++,"?"!==e[a+1]))throw new TypeError("Capturing groups are not allowed at "+a);s+=e[a++]}else s+=e[a++]+e[a++];if(n)throw new TypeError("Unbalanced pattern at "+r);if(!s)throw new TypeError("Missing pattern at "+r);t.push({type:"PATTERN",index:r,value:s}),r=a}else{for(var i="",a=r+1;a<e.length;){var u=e.charCodeAt(a);if(!(u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||95===u))break;i+=e[a++]}if(!i)throw new TypeError("Missing parameter name at "+r);t.push({type:"NAME",index:r,value:i}),r=a}else t.push({type:"CLOSE",index:r,value:e[r++]});else t.push({type:"OPEN",index:r,value:e[r++]});else t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});else t.push({type:"MODIFIER",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}(e),o=t.prefixes,n=void 0===o?"./":o,s="[^"+j(t.delimiter||"/#?")+"]+?",i=[],a=0,u=0,c="",f=function(e){if(u<r.length&&r[u].type===e)return r[u++].value},l=function(e){var t=f(e);if(void 0!==t)return t;var o=r[u],n=o.type,s=o.index;throw new TypeError("Unexpected "+n+" at "+s+", expected "+e)},d=function(){for(var e,t="";e=f("CHAR")||f("ESCAPED_CHAR");)t+=e;return t};u<r.length;){var p=f("CHAR"),h=f("NAME"),y=f("PATTERN");if(h||y){var m=p||"";-1===n.indexOf(m)&&(c+=m,m=""),c&&(i.push(c),c=""),i.push({name:h||a++,prefix:m,suffix:"",pattern:y||s,modifier:f("MODIFIER")||""})}else{var g=p||f("ESCAPED_CHAR");if(g)c+=g;else if(c&&(i.push(c),c=""),f("OPEN")){m=d();var b=f("NAME")||"",w=f("PATTERN")||"",v=d();l("CLOSE"),i.push({name:b||(w?a++:""),pattern:b&&!w?s:w,prefix:m,suffix:v,modifier:f("MODIFIER")||""})}else l("END")}}return i}function E(e,t){return function(e,t){void 0===t&&(t={});var r=S(t),o=t.encode,n=void 0===o?function(e){return e}:o,s=t.validate,i=void 0===s||s,a=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",r)}));return function(t){for(var r="",o=0;o<e.length;o++){var s=e[o];if("string"!=typeof s){var u=t?t[s.name]:void 0,c="?"===s.modifier||"*"===s.modifier,f="*"===s.modifier||"+"===s.modifier;if(Array.isArray(u)){if(!f)throw new TypeError('Expected "'+s.name+'" to not repeat, but got an array');if(0===u.length){if(c)continue;throw new TypeError('Expected "'+s.name+'" to not be empty')}for(var l=0;l<u.length;l++){var d=n(u[l],s);if(i&&!a[o].test(d))throw new TypeError('Expected all "'+s.name+'" to match "'+s.pattern+'", but got "'+d+'"');r+=s.prefix+d+s.suffix}}else if("string"!=typeof u&&"number"!=typeof u){if(!c){var p=f?"an array":"a string";throw new TypeError('Expected "'+s.name+'" to be '+p)}}else{d=n(String(u),s);if(i&&!a[o].test(d))throw new TypeError('Expected "'+s.name+'" to match "'+s.pattern+'", but got "'+d+'"');r+=s.prefix+d+s.suffix}}else r+=s}return r}}(v(e,t),t)}function x(e,t){var r=[];return function(e,t,r){void 0===r&&(r={});var o=r.decode,n=void 0===o?function(e){return e}:o;return function(r){var o=e.exec(r);if(!o)return!1;for(var s=o[0],i=o.index,a=Object.create(null),u=function(e){if(void 0===o[e])return"continue";var r=t[e-1];"*"===r.modifier||"+"===r.modifier?a[r.name]=o[e].split(r.prefix+r.suffix).map((function(e){return n(e,r)})):a[r.name]=n(o[e],r)},c=1;c<o.length;c++)u(c);return{path:s,index:i,params:a}}}(O(e,r,t),r,t)}function j(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function S(e){return e&&e.sensitive?"":"i"}function C(e,t,r){return function(e,t,r){void 0===r&&(r={});for(var o=r.strict,n=void 0!==o&&o,s=r.start,i=void 0===s||s,a=r.end,u=void 0===a||a,c=r.encode,f=void 0===c?function(e){return e}:c,l="["+j(r.endsWith||"")+"]|$",d="["+j(r.delimiter||"/#?")+"]",p=i?"^":"",h=0,y=e;h<y.length;h++){var m=y[h];if("string"==typeof m)p+=j(f(m));else{var g=j(f(m.prefix)),b=j(f(m.suffix));if(m.pattern)if(t&&t.push(m),g||b)if("+"===m.modifier||"*"===m.modifier){var w="*"===m.modifier?"?":"";p+="(?:"+g+"((?:"+m.pattern+")(?:"+b+g+"(?:"+m.pattern+"))*)"+b+")"+w}else p+="(?:"+g+"("+m.pattern+")"+b+")"+m.modifier;else p+="("+m.pattern+")"+m.modifier;else p+="(?:"+g+b+")"+m.modifier}}if(u)n||(p+=d+"?"),p+=r.endsWith?"(?="+l+")":"$";else{var v=e[e.length-1],E="string"==typeof v?d.indexOf(v[v.length-1])>-1:void 0===v;n||(p+="(?:"+d+"(?="+l+"))?"),E||(p+="(?="+d+"|"+l+")")}return new RegExp(p,S(r))}(v(e,r),t,r)}function O(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var o=0;o<r.length;o++)t.push({name:o,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,t):Array.isArray(e)?function(e,t,r){var o=e.map((function(e){return O(e,t,r).source}));return new RegExp("(?:"+o.join("|")+")",S(r))}(e,t,r):C(e,t,r)}function T(e,t){return x(t,{decode:decodeURIComponent})(e)}function P(e,t){try{const r=e.toLowerCase();if(r.startsWith("https://")||r.startsWith("http://")){const{origin:r,pathname:o}=new URL(e),n=`${r}${E(o,{encode:encodeURIComponent})(t)}`;return!e.endsWith("/")&&n.endsWith("/")?n.slice(0,-1):n}{const r=e.replace(/\?/g,"\\?");return E(r,{encode:encodeURIComponent})(t)}}catch(t){return console.error(`Could not compile destination ${e}, returning null instead. Error: ${t}`),null}}function A(e,t){if(t.i18n){const r=t.i18n.defaultLocale,o=t.i18n.locales,n=t.basePath;for(const r of o)if(e===`${t.basePath}/${r}`||e.startsWith(`${t.basePath}/${r}/`))return e;return"/"===e||e===""+n?`${n}/${r}`:e.replace(n+"/",`${n}/${r}/`)}return e}function R(e,t){if(t.i18n)for(const r of t.i18n.locales)if(e==="/"+r||e.startsWith(`/${r}/`))return!0;return!1}function q(e,t){if(t.i18n)for(const r of t.i18n.locales){if(e==="/"+r)return"/";if(e.startsWith(`/${r}/`))return e.replace("/"+r,"")}return e}function B(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var k=function(...e){try{return JSON.stringify.apply(null,e)}catch(e){return"[Cannot display object: "+e.message+"]"}},$=B((function(e,t){e.exports=class extends Error{constructor(e){super(e.filter((e=>""!==e)).map((e=>"string"==typeof e?e:e instanceof Error?e.message:k(e))).join(" ")||"Unknown error"),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t.assert)}}})),L=function(e,...t){if(!e){if(1===t.length&&t[0]instanceof Error)throw t[0];throw new $(t)}};const M={};var I=function(e,t,r){if(!1===t||null==t)return e;"string"==typeof(r=r||{})&&(r={separator:r});const o=Array.isArray(t);L(!o||!r.separator,"Separator option no valid for array-based chain");const n=o?t:t.split(r.separator||".");let s=e;for(let e=0;e<n.length;++e){let o=n[e];const i=r.iterables&&M.iterables(s);if(Array.isArray(s)||"set"===i){const e=Number(o);Number.isInteger(e)&&(o=e<0?s.length+e:e)}if(!s||"function"==typeof s&&!1===r.functions||!i&&void 0===s[o]){L(!r.strict||e+1===n.length,"Missing segment",o,"in reach path ",t),L("object"==typeof s||!0===r.functions||"function"!=typeof s,"Invalid segment",o,"in reach path ",t),s=r.default;break}s=i?"set"===i?[...s][o]:s.get(o):s[o]}return s};M.iterables=function(e){return e instanceof Set?"set":e instanceof Map?"map":void 0};var z=B((function(e,t){const r={};t=e.exports={array:Array.prototype,buffer:Buffer&&Buffer.prototype,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype},r.typeMap=new Map([["[object Error]",t.error],["[object Map]",t.map],["[object Promise]",t.promise],["[object Set]",t.set],["[object WeakMap]",t.weakMap],["[object WeakSet]",t.weakSet]]),t.getInternalProto=function(e){if(Array.isArray(e))return t.array;if(Buffer&&e instanceof Buffer)return t.buffer;if(e instanceof Date)return t.date;if(e instanceof RegExp)return t.regex;if(e instanceof Error)return t.error;const o=Object.prototype.toString.call(e);return r.typeMap.get(o)||t.generic}})),H=function(e,t={}){return!1!==t.symbols?Reflect.ownKeys(e):Object.getOwnPropertyNames(e)};const N={needsProtoHack:new Set([z.set,z.map,z.weakSet,z.weakMap])};var U=N.clone=function(e,t={},r=null){if("object"!=typeof e||null===e)return e;let o=N.clone,n=r;if(t.shallow){if(!0!==t.shallow)return N.cloneWithShallow(e,t);o=e=>e}else if(n){const t=n.get(e);if(t)return t}else n=new Map;const s=z.getInternalProto(e);if(s===z.buffer)return Buffer&&Buffer.from(e);if(s===z.date)return new Date(e.getTime());if(s===z.regex)return new RegExp(e);const i=N.base(e,s,t);if(i===e)return e;if(n&&n.set(e,i),s===z.set)for(const r of e)i.add(o(r,t,n));else if(s===z.map)for(const[r,s]of e)i.set(r,o(s,t,n));const a=H(e,t);for(const r of a){if("__proto__"===r)continue;if(s===z.array&&"length"===r){i.length=e.length;continue}const a=Object.getOwnPropertyDescriptor(e,r);a?a.get||a.set?Object.defineProperty(i,r,a):a.enumerable?i[r]=o(e[r],t,n):Object.defineProperty(i,r,{enumerable:!1,writable:!0,configurable:!0,value:o(e[r],t,n)}):Object.defineProperty(i,r,{enumerable:!0,writable:!0,configurable:!0,value:o(e[r],t,n)})}return i};N.cloneWithShallow=function(e,t){const r=t.shallow;(t=Object.assign({},t)).shallow=!1;const o=new Map;for(const t of r){const r=I(e,t);"object"!=typeof r&&"function"!=typeof r||o.set(r,r)}return N.clone(e,t,o)},N.base=function(e,t,r){if(!1===r.prototype)return N.needsProtoHack.has(t)?new t.constructor:t===z.array?[]:{};const o=Object.getPrototypeOf(e);if(o&&o.isImmutable)return e;if(t===z.array){const e=[];return o!==t&&Object.setPrototypeOf(e,o),e}if(N.needsProtoHack.has(t)){const e=new o.constructor;return o!==t&&Object.setPrototypeOf(e,o),e}return Object.create(o)};const D={};var F=D.merge=function(e,t,r){if(L(e&&"object"==typeof e,"Invalid target value: must be an object"),L(null==t||"object"==typeof t,"Invalid source value: must be null, undefined, or an object"),!t)return e;if(r=Object.assign({nullOverride:!0,mergeArrays:!0},r),Array.isArray(t)){L(Array.isArray(e),"Cannot merge array onto an object"),r.mergeArrays||(e.length=0);for(let o=0;o<t.length;++o)e.push(U(t[o],{symbols:r.symbols}));return e}const o=H(t,r);for(let n=0;n<o.length;++n){const s=o[n];if("__proto__"===s||!Object.prototype.propertyIsEnumerable.call(t,s))continue;const i=t[s];if(i&&"object"==typeof i){if(e[s]===i)continue;!e[s]||"object"!=typeof e[s]||Array.isArray(e[s])!==Array.isArray(i)||i instanceof Date||Buffer&&Buffer.isBuffer(i)||i instanceof RegExp?e[s]=U(i,{symbols:r.symbols}):D.merge(e[s],i,r)}else(null!=i||r.nullOverride)&&(e[s]=i)}return e};const _={};_.applyToDefaultsWithShallow=function(e,t,r){const o=r.shallow;L(Array.isArray(o),"Invalid keys");const n=new Map,s=!0===t?null:new Set;for(let r of o){r=Array.isArray(r)?r:r.split(".");const o=I(e,r);o&&"object"==typeof o?n.set(o,s&&I(t,r)||o):s&&s.add(r)}const i=U(e,{},n);if(!s)return i;for(const e of s)_.reachCopy(i,t,e);return F(i,t,{mergeArrays:!1,nullOverride:!1})},_.reachCopy=function(e,t,r){for(const e of r){if(!(e in t))return;t=t[e]}const o=t;let n=e;for(let e=0;e<r.length-1;++e){const t=r[e];"object"!=typeof n[t]&&(n[t]={}),n=n[t]}n[r[r.length-1]]=o};const W={};var G=W.Bench=class{constructor(){this.ts=0,this.reset()}reset(){this.ts=W.Bench.now()}elapsed(){return W.Bench.now()-this.ts}static now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},V=function(){};const K={mismatched:null};var J=function(e,t,r){return r=Object.assign({prototype:!0},r),!!K.isDeepEqual(e,t,r,[])};K.isDeepEqual=function(e,t,r,o){if(e===t)return 0!==e||1/e==1/t;const n=typeof e;if(n!==typeof t)return!1;if(null===e||null===t)return!1;if("function"===n){if(!r.deepFunction||e.toString()!==t.toString())return!1}else if("object"!==n)return e!=e&&t!=t;const s=K.getSharedType(e,t,!!r.prototype);switch(s){case z.buffer:return Buffer&&Buffer.prototype.equals.call(e,t);case z.promise:return e===t;case z.regex:return e.toString()===t.toString();case K.mismatched:return!1}for(let r=o.length-1;r>=0;--r)if(o[r].isSame(e,t))return!0;o.push(new K.SeenEntry(e,t));try{return!!K.isDeepEqualObj(s,e,t,r,o)}finally{o.pop()}},K.getSharedType=function(e,t,r){if(r)return Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?K.mismatched:z.getInternalProto(e);const o=z.getInternalProto(e);return o!==z.getInternalProto(t)?K.mismatched:o},K.valueOf=function(e){const t=e.valueOf;if(void 0===t)return e;try{return t.call(e)}catch(e){return e}},K.hasOwnEnumerableProperty=function(e,t){return Object.prototype.propertyIsEnumerable.call(e,t)},K.isSetSimpleEqual=function(e,t){for(const r of Set.prototype.values.call(e))if(!Set.prototype.has.call(t,r))return!1;return!0},K.isDeepEqualObj=function(e,t,r,o,n){const{isDeepEqual:s,valueOf:i,hasOwnEnumerableProperty:a}=K,{keys:u,getOwnPropertySymbols:c}=Object;if(e===z.array){if(!o.part){if(t.length!==r.length)return!1;for(let e=0;e<t.length;++e)if(!s(t[e],r[e],o,n))return!1;return!0}for(const e of t)for(const t of r)if(s(e,t,o,n))return!0}else if(e===z.set){if(t.size!==r.size)return!1;if(!K.isSetSimpleEqual(t,r)){const e=new Set(Set.prototype.values.call(r));for(const r of Set.prototype.values.call(t)){if(e.delete(r))continue;let t=!1;for(const i of e)if(s(r,i,o,n)){e.delete(i),t=!0;break}if(!t)return!1}}}else if(e===z.map){if(t.size!==r.size)return!1;for(const[e,i]of Map.prototype.entries.call(t)){if(void 0===i&&!Map.prototype.has.call(r,e))return!1;if(!s(i,Map.prototype.get.call(r,e),o,n))return!1}}else if(e===z.error&&(t.name!==r.name||t.message!==r.message))return!1;const f=i(t),l=i(r);if((t!==f||r!==l)&&!s(f,l,o,n))return!1;const d=u(t);if(!o.part&&d.length!==u(r).length&&!o.skip)return!1;let p=0;for(const e of d)if(o.skip&&o.skip.includes(e))void 0===r[e]&&++p;else{if(!a(r,e))return!1;if(!s(t[e],r[e],o,n))return!1}if(!o.part&&d.length-p!==u(r).length)return!1;if(!1!==o.symbols){const e=c(t),i=new Set(c(r));for(const u of e){if(!o.skip||!o.skip.includes(u))if(a(t,u)){if(!a(r,u))return!1;if(!s(t[u],r[u],o,n))return!1}else if(a(r,u))return!1;i.delete(u)}for(const e of i)if(a(r,e))return!1}return!0},K.SeenEntry=class{constructor(e,t){this.obj=e,this.ref=t}isSame(e,t){return this.obj===e&&this.ref===t}};var Z=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")};const Q={};Q.array=function(e,t,r){if(Array.isArray(t)||(t=[t]),!e.length)return!1;if(r.only&&r.once&&e.length!==t.length)return!1;let o;const n=new Map;for(const e of t)if(r.deep&&e&&"object"==typeof e){o=o||Q.compare(r);let t=!1;for(const[r,s]of n.entries())if(o(r,e)){++s.allowed,t=!0;break}t||n.set(e,{allowed:1,hits:0})}else{const t=n.get(e);t?++t.allowed:n.set(e,{allowed:1,hits:0})}let s=0;for(const t of e){let e;if(r.deep&&t&&"object"==typeof t){o=o||Q.compare(r);for(const[r,s]of n.entries())if(o(r,t)){e=s;break}}else e=n.get(t);if(e&&(++e.hits,++s,r.once&&e.hits>e.allowed))return!1}if(r.only&&s!==e.length)return!1;for(const e of n.values())if(e.hits!==e.allowed&&e.hits<e.allowed&&!r.part)return!1;return!!s},Q.object=function(e,t,r){L(void 0===r.once,"Cannot use option once with object");const o=H(e,r);if(!o.length)return!1;if(Array.isArray(t))return Q.array(o,t,r);const n=Object.getOwnPropertySymbols(t).filter((e=>t.propertyIsEnumerable(e))),s=[...Object.keys(t),...n],i=Q.compare(r),a=new Set(s);for(const n of o)if(a.has(n)){if(!i(t[n],e[n]))return!1;a.delete(n)}else if(r.only)return!1;return!a.size||!!r.part&&a.size<s.length},Q.string=function(e,t,r){if(""===e)return 1===t.length&&""===t[0]||!r.once&&!t.some((e=>""!==e));const o=new Map,n=[];for(const e of t)if(L("string"==typeof e,"Cannot compare string reference to non-string value"),e){const t=o.get(e);t?++t.allowed:(o.set(e,{allowed:1,hits:0}),n.push(Z(e)))}else if(r.once||r.only)return!1;if(!n.length)return!0;const s=new RegExp(`(${n.join("|")})`,"g"),i=e.replace(s,((e,t)=>(++o.get(t).hits,"")));if(r.only&&i)return!1;let a=!1;for(const e of o.values())if(e.hits&&(a=!0),e.hits!==e.allowed){if(e.hits<e.allowed&&!r.part)return!1;if(r.once)return!1}return!!a},Q.compare=function(e){if(!e.deep)return Q.shallow;const t=void 0!==e.only,r=void 0!==e.part,o={prototype:t?e.only:!!r&&!e.part,part:t?!e.only:!!r&&e.part};return(e,t)=>J(e,t,o)},Q.shallow=function(e,t){return e===t};const Y={};Y.escapeHtmlChar=function(e){const t=Y.namedHtml[e];if(void 0!==t)return t;if(e>=256)return"&#"+e+";";return`&#x${e.toString(16).padStart(2,"0")};`},Y.isSafe=function(e){return void 0!==Y.safeCharCodes[e]},Y.namedHtml={38:"&amp;",60:"&lt;",62:"&gt;",34:"&quot;",160:"&nbsp;",162:"&cent;",163:"&pound;",164:"&curren;",169:"&copy;",174:"&reg;"},Y.safeCharCodes=function(){const e={};for(let t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||32===t||46===t||44===t||45===t||58===t||95===t)&&(e[t]=null);return e}();const X={};var ee=X.flatten=function(e,t){const r=t||[];for(let t=0;t<e.length;++t)Array.isArray(e[t])?X.flatten(e[t],r):r.push(e[t]);return r};const te={};te.has=function(e,t){return"function"==typeof e.has?e.has(t):void 0!==e[t]};var re={applyToDefaults:function(e,t,r={}){if(L(e&&"object"==typeof e,"Invalid defaults value: must be an object"),L(!t||!0===t||"object"==typeof t,"Invalid source value: must be true, falsy or an object"),L("object"==typeof r,"Invalid options: must be an object"),!t)return null;if(r.shallow)return _.applyToDefaultsWithShallow(e,t,r);const o=U(e);if(!0===t)return o;const n=void 0!==r.nullOverride&&r.nullOverride;return F(o,t,{nullOverride:n,mergeArrays:!1})},assert:L,Bench:G,block:function(){return new Promise(V)},clone:U,contain:function(e,t,r={}){return"object"!=typeof t&&(t=[t]),L(!Array.isArray(t)||t.length,"Values array cannot be empty"),"string"==typeof e?Q.string(e,t,r):Array.isArray(e)?Q.array(e,t,r):(L("object"==typeof e,"Reference must be string or an object"),Q.object(e,t,r))},deepEqual:J,Error:$,escapeHeaderAttribute:function(e){return L(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~\"\\]*$/.test(e),"Bad attribute value ("+e+")"),e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},escapeHtml:function(e){if(!e)return"";let t="";for(let r=0;r<e.length;++r){const o=e.charCodeAt(r);Y.isSafe(o)?t+=e[r]:t+=Y.escapeHtmlChar(o)}return t},escapeJson:function(e){if(!e)return"";let t;return e.replace(/[<>&\u2028\u2029]/g,(e=>(t=e.charCodeAt(0),60===t?"\\u003c":62===t?"\\u003e":38===t?"\\u0026":8232===t?"\\u2028":"\\u2029")))},escapeRegex:Z,flatten:ee,ignore:V,intersect:function(e,t,r={}){if(!e||!t)return r.first?null:[];const o=[],n=Array.isArray(e)?new Set(e):e,s=new Set;for(const e of t)if(te.has(n,e)&&!s.has(e)){if(r.first)return e;o.push(e),s.add(e)}return r.first?null:o},isPromise:function(e){return!!e&&"function"==typeof e.then},merge:F,once:function(e){if(e._hoekOnce)return e;let t=!1;const r=function(...r){t||(t=!0,e(...r))};return r._hoekOnce=!0,r},reach:I,reachTemplate:function(e,t,r){return t.replace(/{([^}]+)}/g,((t,o)=>{const n=I(e,o,r);return null==n?"":n}))},stringify:k,wait:function(e,t){if("number"!=typeof e&&void 0!==e)throw new TypeError("Timeout must be a number");return new Promise((r=>setTimeout(r,e,t)))}},oe=B((function(e,t){const r={codes:new Map([[100,"Continue"],[101,"Switching Protocols"],[102,"Processing"],[200,"OK"],[201,"Created"],[202,"Accepted"],[203,"Non-Authoritative Information"],[204,"No Content"],[205,"Reset Content"],[206,"Partial Content"],[207,"Multi-Status"],[300,"Multiple Choices"],[301,"Moved Permanently"],[302,"Moved Temporarily"],[303,"See Other"],[304,"Not Modified"],[305,"Use Proxy"],[307,"Temporary Redirect"],[400,"Bad Request"],[401,"Unauthorized"],[402,"Payment Required"],[403,"Forbidden"],[404,"Not Found"],[405,"Method Not Allowed"],[406,"Not Acceptable"],[407,"Proxy Authentication Required"],[408,"Request Time-out"],[409,"Conflict"],[410,"Gone"],[411,"Length Required"],[412,"Precondition Failed"],[413,"Request Entity Too Large"],[414,"Request-URI Too Large"],[415,"Unsupported Media Type"],[416,"Requested Range Not Satisfiable"],[417,"Expectation Failed"],[418,"I'm a teapot"],[422,"Unprocessable Entity"],[423,"Locked"],[424,"Failed Dependency"],[425,"Too Early"],[426,"Upgrade Required"],[428,"Precondition Required"],[429,"Too Many Requests"],[431,"Request Header Fields Too Large"],[451,"Unavailable For Legal Reasons"],[500,"Internal Server Error"],[501,"Not Implemented"],[502,"Bad Gateway"],[503,"Service Unavailable"],[504,"Gateway Time-out"],[505,"HTTP Version Not Supported"],[506,"Variant Also Negotiates"],[507,"Insufficient Storage"],[509,"Bandwidth Limit Exceeded"],[510,"Not Extended"],[511,"Network Authentication Required"]])};t.Boom=class extends Error{constructor(e,o={}){if(e instanceof Error)return t.boomify(re.clone(e),o);const{statusCode:n=500,data:s=null,ctor:i=t.Boom}=o,a=new Error(e||void 0);Error.captureStackTrace(a,i),a.data=s;const u=r.initialize(a,n);return Object.defineProperty(u,"typeof",{value:i}),o.decorate&&Object.assign(u,o.decorate),u}static[Symbol.hasInstance](e){return t.isBoom(e)}},t.isBoom=function(e,t){return e instanceof Error&&!!e.isBoom&&(!t||e.output.statusCode===t)},t.boomify=function(e,t){return re.assert(e instanceof Error,"Cannot wrap non-Error object"),void 0!==(t=t||{}).data&&(e.data=t.data),t.decorate&&Object.assign(e,t.decorate),e.isBoom?!1===t.override||!t.statusCode&&!t.message?e:r.initialize(e,t.statusCode||e.output.statusCode,t.message):r.initialize(e,t.statusCode||500,t.message)},t.badRequest=function(e,r){return new t.Boom(e,{statusCode:400,data:r,ctor:t.badRequest})},t.unauthorized=function(e,r,o){const n=new t.Boom(e,{statusCode:401,ctor:t.unauthorized});if(!r)return n;if("string"!=typeof r)return n.output.headers["WWW-Authenticate"]=r.join(", "),n;let s=""+r;return(o||e)&&(n.output.payload.attributes={}),o&&("string"==typeof o?(s+=" "+re.escapeHeaderAttribute(o),n.output.payload.attributes=o):s+=" "+Object.keys(o).map((e=>{let t=o[e];return null==t&&(t=""),n.output.payload.attributes[e]=t,`${e}="${re.escapeHeaderAttribute(t.toString())}"`})).join(", ")),e?(o&&(s+=","),s+=` error="${re.escapeHeaderAttribute(e)}"`,n.output.payload.attributes.error=e):n.isMissing=!0,n.output.headers["WWW-Authenticate"]=s,n},t.paymentRequired=function(e,r){return new t.Boom(e,{statusCode:402,data:r,ctor:t.paymentRequired})},t.forbidden=function(e,r){return new t.Boom(e,{statusCode:403,data:r,ctor:t.forbidden})},t.notFound=function(e,r){return new t.Boom(e,{statusCode:404,data:r,ctor:t.notFound})},t.methodNotAllowed=function(e,r,o){const n=new t.Boom(e,{statusCode:405,data:r,ctor:t.methodNotAllowed});return"string"==typeof o&&(o=[o]),Array.isArray(o)&&(n.output.headers.Allow=o.join(", ")),n},t.notAcceptable=function(e,r){return new t.Boom(e,{statusCode:406,data:r,ctor:t.notAcceptable})},t.proxyAuthRequired=function(e,r){return new t.Boom(e,{statusCode:407,data:r,ctor:t.proxyAuthRequired})},t.clientTimeout=function(e,r){return new t.Boom(e,{statusCode:408,data:r,ctor:t.clientTimeout})},t.conflict=function(e,r){return new t.Boom(e,{statusCode:409,data:r,ctor:t.conflict})},t.resourceGone=function(e,r){return new t.Boom(e,{statusCode:410,data:r,ctor:t.resourceGone})},t.lengthRequired=function(e,r){return new t.Boom(e,{statusCode:411,data:r,ctor:t.lengthRequired})},t.preconditionFailed=function(e,r){return new t.Boom(e,{statusCode:412,data:r,ctor:t.preconditionFailed})},t.entityTooLarge=function(e,r){return new t.Boom(e,{statusCode:413,data:r,ctor:t.entityTooLarge})},t.uriTooLong=function(e,r){return new t.Boom(e,{statusCode:414,data:r,ctor:t.uriTooLong})},t.unsupportedMediaType=function(e,r){return new t.Boom(e,{statusCode:415,data:r,ctor:t.unsupportedMediaType})},t.rangeNotSatisfiable=function(e,r){return new t.Boom(e,{statusCode:416,data:r,ctor:t.rangeNotSatisfiable})},t.expectationFailed=function(e,r){return new t.Boom(e,{statusCode:417,data:r,ctor:t.expectationFailed})},t.teapot=function(e,r){return new t.Boom(e,{statusCode:418,data:r,ctor:t.teapot})},t.badData=function(e,r){return new t.Boom(e,{statusCode:422,data:r,ctor:t.badData})},t.locked=function(e,r){return new t.Boom(e,{statusCode:423,data:r,ctor:t.locked})},t.failedDependency=function(e,r){return new t.Boom(e,{statusCode:424,data:r,ctor:t.failedDependency})},t.tooEarly=function(e,r){return new t.Boom(e,{statusCode:425,data:r,ctor:t.tooEarly})},t.preconditionRequired=function(e,r){return new t.Boom(e,{statusCode:428,data:r,ctor:t.preconditionRequired})},t.tooManyRequests=function(e,r){return new t.Boom(e,{statusCode:429,data:r,ctor:t.tooManyRequests})},t.illegal=function(e,r){return new t.Boom(e,{statusCode:451,data:r,ctor:t.illegal})},t.internal=function(e,o,n=500){return r.serverError(e,o,n,t.internal)},t.notImplemented=function(e,o){return r.serverError(e,o,501,t.notImplemented)},t.badGateway=function(e,o){return r.serverError(e,o,502,t.badGateway)},t.serverUnavailable=function(e,o){return r.serverError(e,o,503,t.serverUnavailable)},t.gatewayTimeout=function(e,o){return r.serverError(e,o,504,t.gatewayTimeout)},t.badImplementation=function(e,o){const n=r.serverError(e,o,500,t.badImplementation);return n.isDeveloperError=!0,n},r.initialize=function(e,t,o){const n=parseInt(t,10);if(re.assert(!isNaN(n)&&n>=400,"First argument must be a number (400+):",t),e.isBoom=!0,e.isServer=n>=500,e.hasOwnProperty("data")||(e.data=null),e.output={statusCode:n,payload:{},headers:{}},Object.defineProperty(e,"reformat",{value:r.reformat}),o||e.message||(e.reformat(),o=e.output.payload.error),o){const t=Object.getOwnPropertyDescriptor(e,"message")||Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),"message");re.assert(!t||t.configurable&&!t.get,"The error is not compatible with boom"),e.message=o+(e.message?": "+e.message:""),e.output.payload.message=e.message}return e.reformat(),e},r.reformat=function(e=!1){this.output.payload.statusCode=this.output.statusCode,this.output.payload.error=r.codes.get(this.output.statusCode)||"Unknown",500===this.output.statusCode&&!0!==e?this.output.payload.message="An internal server error occurred":this.message&&(this.output.payload.message=this.message)},r.serverError=function(e,r,o,n){return r instanceof Error&&!r.isBoom?t.boomify(r,{statusCode:o,message:e}):new t.Boom(e,{statusCode:o,data:r,ctor:n})}})),ne=B((function(e,t){const r={};t.selection=function(e,r,o){const n=t.selections(e,r,o);return n.length?n[0]:""},t.selections=function(e,t,o){return re.assert(!t||Array.isArray(t),"Preferences must be an array"),r.parse(e||"",t,o)},r.parse=function(e,t,o){const n=e.replace(/[ \t]/g,""),s=new Map;if(t)for(let e=0;e<t.length;++e){const r=t[e];s.set(r.toLowerCase(),{orig:r,pos:e})}const i=n.split(","),a=[],u=new Set;for(let e=0;e<i.length;++e){const r=i[e];if(!r)continue;const n=r.split(";");if(n.length>2)throw oe.badRequest(`Invalid ${o.type} header`);let c=n[0].toLowerCase();if(!c)throw oe.badRequest(`Invalid ${o.type} header`);o.equivalents&&o.equivalents.has(c)&&(c=o.equivalents.get(c));const f={token:c,pos:e,q:1,specificity:o.specificity?c.split("-"):null};if(t&&s.has(c)&&(f.pref=s.get(c).pos),u.add(f.token),2===n.length){const e=n[1],[t,r]=e.split("=");if(!r||"q"!==t&&"Q"!==t)throw oe.badRequest(`Invalid ${o.type} header`);const s=parseFloat(r);if(0===s)continue;Number.isFinite(s)&&s<=1&&s>=.001&&(f.q=s)}a.push(f)}a.sort(r.sort);const c=a.map((e=>e.token));if(o.default&&!u.has(o.default)&&c.push(o.default),!t||!t.length)return c;const f=[];for(const e of c)if("*"===e)for(const[e,t]of s)u.has(e)||f.push(t.orig);else{const t=e.toLowerCase();s.has(t)&&f.push(s.get(t).orig)}return f},r.sort=function(e,t){return t.q!==e.q?t.q-e.q:t.pref!==e.pref?void 0===e.pref?1:void 0===t.pref?-1:e.pref-t.pref:e.specificity&&e.specificity[0]===t.specificity[0]&&e.specificity.length!==t.specificity.length?t.specificity.length-e.specificity.length:e.pos-t.pos}})),se=B((function(e,t){const r={};t.selection=function(e,r){const o=t.selections(e,r);return o.length?o[0]:""},t.selections=function(e,t){return re.assert(!t||Array.isArray(t),"Preferences must be an array"),r.parse(e,t)},r.validMediaRx=/^(?:\*\/\*)|(?:[\w\!#\$%&'\*\+\-\.\^`\|~]+\/\*)|(?:[\w\!#\$%&'\*\+\-\.\^`\|~]+\/[\w\!#\$%&'\*\+\-\.\^`\|~]+)$/,r.parse=function(e,t){const{header:o,quoted:n}=r.normalize(e),s=o.split(","),i=[],a={};for(let e=0;e<s.length;++e){const t=s[e];if(!t)continue;const o=t.split(";"),u=o.shift().toLowerCase();if(!r.validMediaRx.test(u))continue;const c={token:u,params:{},exts:{},pos:e};let f="params";for(const e of o){const t=e.split("=");if(2!==t.length||!t[1])throw oe.badRequest("Invalid accept header");const r=t[0];let o=t[1];"q"===r||"Q"===r?(f="exts",o=parseFloat(o),(!Number.isFinite(o)||o>1||o<.001&&0!==o)&&(o=1),c.q=o):('"'===o[0]&&(o=`"${n[o]}"`),c[f][t[0]]=o)}const l=Object.keys(c.params);c.original=[""].concat(l.map((e=>`${e}=${c.params[e]}`))).join(";"),c.specificity=l.length,void 0===c.q&&(c.q=1);const d=c.token.split("/");c.type=d[0],c.subtype=d[1],a[c.token]=c,c.q&&i.push(c)}return i.sort(r.sort),r.preferences(a,i,t)},r.normalize=function(e){const t={header:e=e||"*/*",quoted:{}};if(e.includes('"')){let r=0;t.header=e.replace(/="([^"]*)"/g,((e,o)=>{const n='"'+ ++r;return t.quoted[n]=o,"="+n}))}return t.header=t.header.replace(/[ \t]/g,""),t},r.sort=function(e,t){return t.q!==e.q?t.q-e.q:e.type!==t.type?r.innerSort(e,t,"type"):e.subtype!==t.subtype?r.innerSort(e,t,"subtype"):e.specificity!==t.specificity?t.specificity-e.specificity:e.pos-t.pos},r.innerSort=function(e,t,r){return"*"===e[r]?1:"*"===t[r]||e[r]<t[r]?-1:1},r.preferences=function(e,t,r){if(!r||!r.length)return t.map((e=>e.token+e.original));const o=Object.create(null),n=Object.create(null);let s=!1;for(const e of r){const t=e.toLowerCase();n[t]=e;const r=t.split("/"),i=r[0],a=r[1];"*"!==i?(o[i]=o[i]||Object.create(null),o[i][a]=e):(re.assert("*"===a,"Invalid media type preference contains wildcard type with a subtype"),s=!0)}const i=[];for(const r of t){const t=r.token,{type:a,subtype:u}=e[t],c=o[a];if("*"!==a)if(s)i.push((n[t]||t)+r.original);else if("*"===u){if(c)for(const t of Object.keys(c))e[`${a}/${t}`]||i.push(c[t])}else{const e=n[t];(e||c&&c["*"])&&i.push((e||t)+r.original)}else{for(const t of Object.keys(n))e[t]||i.push(n[t]);s&&i.push("*/*")}}return i}}));B((function(e,t){const r={options:{charset:{type:"accept-charset"},encoding:{type:"accept-encoding",default:"identity",equivalents:new Map([["x-compress","compress"],["x-gzip","gzip"]])},language:{type:"accept-language",specificity:!0}}};for(const e in r.options)t[e]=(t,o)=>ne.selection(t,o,r.options[e]),t[e+"s"]=(t,o)=>ne.selections(t,o,r.options[e]);t.mediaType=(e,t)=>se.selection(e,t),t.mediaTypes=(e,t)=>se.selections(e,t),t.parseAll=function(e){return{charsets:t.charsets(e["accept-charset"]),encodings:t.encodings(e["accept-encoding"]),languages:t.languages(e["accept-language"]),mediaTypes:t.mediaTypes(e.accept)}}}));function ie(e,t,r){let o;if(t){const[r,n]=e.split("?");o=`${r}?${t}${n?"&"+n:""}`}else o=e;const s=r.toString();return{status:s,statusDescription:n.STATUS_CODES[s],headers:{location:[{key:"Location",value:o}],refresh:308===r?[{key:"Refresh",value:"0;url="+o}]:[]}}}const ae=["connection","expect","keep-alive","proxy-authenticate","proxy-authorization","proxy-connection","trailer","upgrade","x-accel-buffering","x-accel-charset","x-accel-limit-rate","x-accel-redirect","x-cache","x-forwarded-proto","x-real-ip","content-length","host","transfer-encoding","via"],ue=["x-amz-cf-","x-amzn-","x-edge-"];function ce(e){const t=e.toLowerCase();for(const e of ue)if(t.startsWith(e))return!0;return ae.includes(t)}const fe=["connection","expect","keep-alive","proxy-authenticate","proxy-authorization","proxy-connection","trailer","upgrade","x-accel-buffering","x-accel-charset","x-accel-limit-rate","x-accel-redirect","x-cache","x-forwarded-proto","x-real-ip"],le=["x-amz-cf-","x-amzn-","x-edge-"];function de(e){const t=e.toLowerCase();for(const e of le)if(t.startsWith(e))return!0;return fe.includes(t)}const pe=c.default.basePath,he=e=>(e.startsWith(pe)&&(e=e.slice(pe.length)),e),ye=e=>{const{apis:{dynamic:t,nonDynamic:r}}=e;return e=>{if(pe&&e.startsWith(pe)&&(e=e.slice(pe.length)),r[e])return r[e];for(const r in t){const{file:o,regex:n}=t[r];if(new RegExp(n,"i").test(e))return o}return null}},me=f.default.Readable,ge=Symbol("buffer"),be=Symbol("type");class we{constructor(){this[be]="";const e=arguments[0],t=arguments[1],r=[];let o=0;if(e){const t=e,n=Number(t.length);for(let e=0;e<n;e++){const n=t[e];let s;s=n instanceof Buffer?n:ArrayBuffer.isView(n)?Buffer.from(n.buffer,n.byteOffset,n.byteLength):n instanceof ArrayBuffer?Buffer.from(n):n instanceof we?n[ge]:Buffer.from("string"==typeof n?n:String(n)),o+=s.length,r.push(s)}}this[ge]=Buffer.concat(r);let n=t&&void 0!==t.type&&String(t.type).toLowerCase();n&&!/[^\u0020-\u007E]/.test(n)&&(this[be]=n)}get size(){return this[ge].length}get type(){return this[be]}text(){return Promise.resolve(this[ge].toString())}arrayBuffer(){const e=this[ge],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new me;return e._read=function(){},e.push(this[ge]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],r=arguments[1];let o,n;o=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),n=void 0===r?e:r<0?Math.max(e+r,0):Math.min(r,e);const s=Math.max(n-o,0),i=this[ge].slice(o,o+s),a=new we([],{type:arguments[2]});return a[ge]=i,a}}function ve(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}let Ee;Object.defineProperties(we.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(we.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),ve.prototype=Object.create(Error.prototype),ve.prototype.constructor=ve,ve.prototype.name="FetchError";try{Ee=require("encoding").convert}catch(e){}const xe=Symbol("Body internals"),je=f.default.PassThrough;function Se(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.size;let n=void 0===o?0:o;var s=r.timeout;let i=void 0===s?0:s;null==e?e=null:Oe(e)?e=Buffer.from(e.toString()):Te(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof f.default||(e=Buffer.from(String(e)))),this[xe]={body:e,disturbed:!1,error:null},this.size=n,this.timeout=i,e instanceof f.default&&e.on("error",(function(e){const r="AbortError"===e.name?e:new ve(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[xe].error=r}))}function Ce(){var e=this;if(this[xe].disturbed)return Se.Promise.reject(new TypeError("body used already for: "+this.url));if(this[xe].disturbed=!0,this[xe].error)return Se.Promise.reject(this[xe].error);let t=this.body;if(null===t)return Se.Promise.resolve(Buffer.alloc(0));if(Te(t)&&(t=t.stream()),Buffer.isBuffer(t))return Se.Promise.resolve(t);if(!(t instanceof f.default))return Se.Promise.resolve(Buffer.alloc(0));let r=[],o=0,n=!1;return new Se.Promise((function(s,i){let a;e.timeout&&(a=setTimeout((function(){n=!0,i(new ve(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))}),e.timeout)),t.on("error",(function(t){"AbortError"===t.name?(n=!0,i(t)):i(new ve(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))})),t.on("data",(function(t){if(!n&&null!==t){if(e.size&&o+t.length>e.size)return n=!0,void i(new ve(`content size at ${e.url} over limit: ${e.size}`,"max-size"));o+=t.length,r.push(t)}})),t.on("end",(function(){if(!n){clearTimeout(a);try{s(Buffer.concat(r,o))}catch(t){i(new ve(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}}))}))}function Oe(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function Te(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function Pe(e){let t,r,o=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof f.default&&"function"!=typeof o.getBoundary&&(t=new je,r=new je,o.pipe(t),o.pipe(r),e[xe].body=t,o=r),o}function Ae(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":Oe(e)?"application/x-www-form-urlencoded;charset=UTF-8":Te(e)?e.type||null:Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?"multipart/form-data;boundary="+e.getBoundary():e instanceof f.default?null:"text/plain;charset=UTF-8"}function Re(e){const t=e.body;return null===t?0:Te(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}Se.prototype={get body(){return this[xe].body},get bodyUsed(){return this[xe].disturbed},arrayBuffer(){return Ce.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return Ce.call(this).then((function(t){return Object.assign(new we([],{type:e.toLowerCase()}),{[ge]:t})}))},json(){var e=this;return Ce.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return Se.Promise.reject(new ve(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return Ce.call(this).then((function(e){return e.toString()}))},buffer(){return Ce.call(this)},textConverted(){var e=this;return Ce.call(this).then((function(t){return function(e,t){if("function"!=typeof Ee)throw new Error("The package `encoding` must be installed to use the textConverted() function");const r=t.get("content-type");let o,n,s="utf-8";r&&(o=/charset=([^;]*)/i.exec(r));n=e.slice(0,1024).toString(),!o&&n&&(o=/<meta.+?charset=(['"])(.+?)\1/i.exec(n));!o&&n&&(o=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(n),o||(o=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(n),o&&o.pop()),o&&(o=/charset=(.*)/i.exec(o.pop())));!o&&n&&(o=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(n));o&&(s=o.pop(),"gb2312"!==s&&"gbk"!==s||(s="gb18030"));return Ee(e,"UTF-8",s).toString()}(t,e.headers)}))}},Object.defineProperties(Se.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),Se.mixIn=function(e){for(const t of Object.getOwnPropertyNames(Se.prototype))if(!(t in e)){const r=Object.getOwnPropertyDescriptor(Se.prototype,t);Object.defineProperty(e,t,r)}},Se.Promise=global.Promise;const qe=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,Be=/[^\t\x20-\x7e\x80-\xff]/;function ke(e){if(e=""+e,qe.test(e)||""===e)throw new TypeError(e+" is not a legal HTTP header name")}function $e(e){if(e=""+e,Be.test(e))throw new TypeError(e+" is not a legal HTTP header value")}function Le(e,t){t=t.toLowerCase();for(const r in e)if(r.toLowerCase()===t)return r}const Me=Symbol("map");class Ie{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[Me]=Object.create(null),e instanceof Ie){const t=e.raw(),r=Object.keys(t);for(const e of r)for(const r of t[e])this.append(e,r)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const r=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");r.push(Array.from(t))}for(const e of r){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const r=e[t];this.append(t,r)}}}}get(e){ke(e=""+e);const t=Le(this[Me],e);return void 0===t?null:this[Me][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=ze(this),o=0;for(;o<r.length;){var n=r[o];const s=n[0],i=n[1];e.call(t,i,s,this),r=ze(this),o++}}set(e,t){t=""+t,ke(e=""+e),$e(t);const r=Le(this[Me],e);this[Me][void 0!==r?r:e]=[t]}append(e,t){t=""+t,ke(e=""+e),$e(t);const r=Le(this[Me],e);void 0!==r?this[Me][r].push(t):this[Me][e]=[t]}has(e){return ke(e=""+e),void 0!==Le(this[Me],e)}delete(e){ke(e=""+e);const t=Le(this[Me],e);void 0!==t&&delete this[Me][t]}raw(){return this[Me]}keys(){return Ne(this,"key")}values(){return Ne(this,"value")}[Symbol.iterator](){return Ne(this,"key+value")}}function ze(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const r=Object.keys(e[Me]).sort();return r.map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[Me][t].join(", ")}:function(t){return[t.toLowerCase(),e[Me][t].join(", ")]})}Ie.prototype.entries=Ie.prototype[Symbol.iterator],Object.defineProperty(Ie.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Ie.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const He=Symbol("internal");function Ne(e,t){const r=Object.create(Ue);return r[He]={target:e,kind:t,index:0},r}const Ue=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==Ue)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[He];const t=e.target,r=e.kind,o=e.index,n=ze(t,r);return o>=n.length?{value:void 0,done:!0}:(this[He].index=o+1,{value:n[o],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function De(e){const t=Object.assign({__proto__:null},e[Me]),r=Le(e[Me],"Host");return void 0!==r&&(t[r]=t[r][0]),t}Object.defineProperty(Ue,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const Fe=Symbol("Response internals"),_e=d.default.STATUS_CODES;class We{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Se.call(this,e,t);const r=t.status||200,o=new Ie(t.headers);if(null!=e&&!o.has("Content-Type")){const t=Ae(e);t&&o.append("Content-Type",t)}this[Fe]={url:t.url,status:r,statusText:t.statusText||_e[r],headers:o,counter:t.counter}}get url(){return this[Fe].url||""}get status(){return this[Fe].status}get ok(){return this[Fe].status>=200&&this[Fe].status<300}get redirected(){return this[Fe].counter>0}get statusText(){return this[Fe].statusText}get headers(){return this[Fe].headers}clone(){return new We(Pe(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}Se.mixIn(We.prototype),Object.defineProperties(We.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(We.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const Ge=Symbol("Request internals"),Ve=p.default.parse,Ke=p.default.format,Je="destroy"in f.default.Readable.prototype;function Ze(e){return"object"==typeof e&&"object"==typeof e[Ge]}class Qe{constructor(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ze(e)?t=Ve(e.url):(t=e&&e.href?Ve(e.href):Ve(""+e),e={});let o=r.method||e.method||"GET";if(o=o.toUpperCase(),(null!=r.body||Ze(e)&&null!==e.body)&&("GET"===o||"HEAD"===o))throw new TypeError("Request with GET/HEAD method cannot have body");let n=null!=r.body?r.body:Ze(e)&&null!==e.body?Pe(e):null;Se.call(this,n,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});const s=new Ie(r.headers||e.headers||{});if(null!=n&&!s.has("Content-Type")){const e=Ae(n);e&&s.append("Content-Type",e)}let i=Ze(e)?e.signal:null;if("signal"in r&&(i=r.signal),null!=i&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(i))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[Ge]={method:o,redirect:r.redirect||e.redirect||"follow",headers:s,parsedURL:t,signal:i},this.follow=void 0!==r.follow?r.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===e.compress||e.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}get method(){return this[Ge].method}get url(){return Ke(this[Ge].parsedURL)}get headers(){return this[Ge].headers}get redirect(){return this[Ge].redirect}get signal(){return this[Ge].signal}clone(){return new Qe(this)}}function Ye(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}Se.mixIn(Qe.prototype),Object.defineProperty(Qe.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Qe.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),Ye.prototype=Object.create(Error.prototype),Ye.prototype.constructor=Ye,Ye.prototype.name="AbortError";const Xe=f.default.PassThrough,et=p.default.resolve;function tt(e,t){if(!tt.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return Se.Promise=tt.Promise,new tt.Promise((function(r,o){const n=new Qe(e,t),s=function(e){const t=e[Ge].parsedURL,r=new Ie(e[Ge].headers);if(r.has("Accept")||r.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof f.default.Readable&&!Je)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let o=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(o="0"),null!=e.body){const t=Re(e);"number"==typeof t&&(o=String(t))}o&&r.set("Content-Length",o),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let n=e.agent;return"function"==typeof n&&(n=n(t)),r.has("Connection")||n||r.set("Connection","close"),Object.assign({},t,{method:e.method,headers:De(r),agent:n})}(n),i=("https:"===s.protocol?h.default:d.default).request,a=n.signal;let u=null;const c=function(){let e=new Ye("The user aborted a request.");o(e),n.body&&n.body instanceof f.default.Readable&&n.body.destroy(e),u&&u.body&&u.body.emit("error",e)};if(a&&a.aborted)return void c();const p=function(){c(),g()},y=i(s);let m;function g(){y.abort(),a&&a.removeEventListener("abort",p),clearTimeout(m)}a&&a.addEventListener("abort",p),n.timeout&&y.once("socket",(function(e){m=setTimeout((function(){o(new ve("network timeout at: "+n.url,"request-timeout")),g()}),n.timeout)})),y.on("error",(function(e){o(new ve(`request to ${n.url} failed, reason: ${e.message}`,"system",e)),g()})),y.on("response",(function(e){clearTimeout(m);const t=function(e){const t=new Ie;for(const r of Object.keys(e))if(!qe.test(r))if(Array.isArray(e[r]))for(const o of e[r])Be.test(o)||(void 0===t[Me][r]?t[Me][r]=[o]:t[Me][r].push(o));else Be.test(e[r])||(t[Me][r]=[e[r]]);return t}(e.headers);if(tt.isRedirect(e.statusCode)){const s=t.get("Location"),i=null===s?null:et(n.url,s);switch(n.redirect){case"error":return o(new ve("uri requested responds with a redirect, redirect mode is set to error: "+n.url,"no-redirect")),void g();case"manual":if(null!==i)try{t.set("Location",i)}catch(e){o(e)}break;case"follow":if(null===i)break;if(n.counter>=n.follow)return o(new ve("maximum redirect reached at: "+n.url,"max-redirect")),void g();const s={headers:new Ie(n.headers),follow:n.follow,counter:n.counter+1,agent:n.agent,compress:n.compress,method:n.method,body:n.body,signal:n.signal,timeout:n.timeout,size:n.size};return 303!==e.statusCode&&n.body&&null===Re(n)?(o(new ve("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void g()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==n.method)||(s.method="GET",s.body=void 0,s.headers.delete("content-length")),r(tt(new Qe(i,s))),void g())}}e.once("end",(function(){a&&a.removeEventListener("abort",p)}));let s=e.pipe(new Xe);const i={url:n.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:n.size,timeout:n.timeout,counter:n.counter},c=t.get("Content-Encoding");if(!n.compress||"HEAD"===n.method||null===c||204===e.statusCode||304===e.statusCode)return u=new We(s,i),void r(u);const f={flush:l.default.Z_SYNC_FLUSH,finishFlush:l.default.Z_SYNC_FLUSH};if("gzip"==c||"x-gzip"==c)return s=s.pipe(l.default.createGunzip(f)),u=new We(s,i),void r(u);if("deflate"!=c&&"x-deflate"!=c){if("br"==c&&"function"==typeof l.default.createBrotliDecompress)return s=s.pipe(l.default.createBrotliDecompress()),u=new We(s,i),void r(u);u=new We(s,i),r(u)}else{e.pipe(new Xe).once("data",(function(e){s=8==(15&e[0])?s.pipe(l.default.createInflate()):s.pipe(l.default.createInflateRaw()),u=new We(s,i),r(u)}))}})),function(e,t){const r=t.body;null===r?e.end():Te(r)?r.stream().pipe(e):Buffer.isBuffer(r)?(e.write(r),e.end()):r.pipe(e)}(y,n)}))}tt.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},tt.Promise=global.Promise;var rt=Object.freeze({__proto__:null,default:tt,Headers:Ie,Request:Qe,Response:We,FetchError:ve});exports.handler=async e=>{var t;const r=e.Records[0].cf.request,o=c.default,n=u.default,s=r.headers.authorization,i=function(e,t){if(t&&t.username&&t.password&&e!=="Basic "+Buffer.from(t.username+":"+t.password).toString("base64"))return{status:"401",statusDescription:"Unauthorized",body:"Unauthorized",headers:{"www-authenticate":[{key:"WWW-Authenticate",value:"Basic"}]}};return null}(s?s[0].value:null,u.default.authentication);if(i)return i;const a=function(e,t){const r=e.headers.host;if(r&&r.length>0){const o=r[0].value,n=t.domainRedirects;if(n&&n[o])return`${n[o]}${e.uri}`}return null}(r,n);if(a)return ie(a,r.querystring,308);const f=function(e,t){e=A(e,t);const r=t.redirects;for(const t of r){const r=T(e,t.source);if(r){const e=P(t.destination,r.params);return e?{redirectPath:e,statusCode:t.statusCode}:null}}return null}(r.uri,o);if(f)return ie(f.redirectPath,r.querystring,f.statusCode);let l=n.apis.nonDynamic[he(r.uri)],d=he(r.uri);if(d=q(d,o),!l){const n=function(e,t,r,o){e=A(e,t);const n=t.rewrites;for(const s of n){const n=T(e,s.source);if(n){let i=P(s.destination,n.params);if(e===i){const e=r(o);if("pages/404.html"===e||"pages/_error.js"===e)continue}if(i&&R(e,t)){const e=Object.keys(n.params).filter((e=>"nextInternalLocale"!==e)).map((e=>{const t=n.params[e];return"string"==typeof t?`${e}=${t}`:t.map((t=>`${e}=${t}`)).join("&")})).filter((e=>e)).join("&");e&&(i+=i.includes("?")?"&"+e:"?"+e)}return i}}return null}(r.uri,o,ye(u.default),d);if(n){const[s,i]=n.split("?");if(r.querystring?r.querystring=`${r.querystring}${i?"&"+i:""}`:r.querystring=""+(null!=i?i:""),function(e){return e.startsWith("http://")||e.startsWith("https://")}(n)){const{req:o,res:n,responsePromise:i}=w(e.Records[0].cf,{enableHTTPCompression:u.default.enableHTTPCompression});return await async function(e,t,r,o){const{default:n}=await Promise.resolve().then((function(){return rt}));let s,i={};if(Object.assign(i,t.headers),i.hasOwnProperty("host")&&delete i.host,o){const r=Buffer.from(o,"base64").toString("utf8");s=await n(e,{headers:i,method:t.method,body:r,compress:!1})}else s=await n(e,{headers:i,method:t.method,compress:!1});for(const[e,t]of s.headers.entries())ce(e)||r.setHeader(e,t);r.statusCode=s.status,r.end(await s.buffer())}(s+(r.querystring?"?":"")+r.querystring,o,n,null===(t=r.body)||void 0===t?void 0:t.data),await i}r.uri=s,d=he(r.uri),d=q(d,o)}}const p=ye(u.default)(d);if(!p)return{status:"404"};const h=require("./"+p),{req:y,res:m,responsePromise:g}=w(e.Records[0].cf,{enableHTTPCompression:n.enableHTTPCompression});h.default(y,m);const b=await g;return function(e,t,r){if(e=A(e,r),t.headers)for(const o of r.headers)if(T(e,o.source))for(const e of o.headers)if(e.key&&e.value){const r=e.key.toLowerCase();t.headers[r]=[{key:r,value:e.value}]}}(r.uri,b,o),b.headers&&function(e){for(const t in e)de(t)&&delete e[t]}(b.headers),b};
